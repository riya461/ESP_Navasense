<!DOCTYPE html>
<html>
<head>
    <title>MPU6050 Real-time Data</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { display: flex; flex-wrap: wrap; }
        .panel { border: 1px solid #ddd; padding: 15px; margin: 10px; border-radius: 5px; }
        .value { font-size: 24px; font-weight: bold; }
        canvas { background: #f5f5f5; margin-top: 10px; }
        .sensor-title { font-size: 18px; margin-bottom: 10px; color: #333; }
    </style>
</head>
<body>
    <h1>MPU6050 Sensor Data over WiFi</h1>
    
    <div class="container">
        <div class="panel">
            <div class="sensor-title">Accelerometer (m/sÂ²)</div>
            <div>X: <span id="accel-x" class="value">0.00</span></div>
            <div>Y: <span id="accel-y" class="value">0.00</span></div>
            <div>Z: <span id="accel-z" class="value">0.00</span></div>
            <canvas id="accelChart" width="300" height="200"></canvas>
        </div>
        
        <div class="panel">
            <div class="sensor-title">Gyroscope (rad/s)</div>
            <div>X: <span id="gyro-x" class="value">0.00</span></div>
            <div>Y: <span id="gyro-y" class="value">0.00</span></div>
            <div>Z: <span id="gyro-z" class="value">0.00</span></div>
            <canvas id="gyroChart" width="300" height="200"></canvas>
        </div>
    </div>

    <script>
        const ws = new WebSocket('ws://localhost:8080');
        const accelCtx = document.getElementById('accelChart').getContext('2d');
        const gyroCtx = document.getElementById('gyroChart').getContext('2d');
        
        // Data history for graphs
        const historySize = 50;
        let accelData = { x: [], y: [], z: [] };
        let gyroData = { x: [], y: [], z: [] };
        
        // Initialize charts
        const accelChart = createChart(accelCtx, 'Accelerometer', ['#FF6384', '#36A2EB', '#FFCE56']);
        const gyroChart = createChart(gyroCtx, 'Gyroscope', ['#4BC0C0', '#9966FF', '#FF9F40']);
        
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            // Update display values
            document.getElementById('accel-x').textContent = data.a[0].toFixed(2);
            document.getElementById('accel-y').textContent = data.a[1].toFixed(2);
            document.getElementById('accel-z').textContent = data.a[2].toFixed(2);
            
            document.getElementById('gyro-x').textContent = data.g[0].toFixed(2);
            document.getElementById('gyro-y').textContent = data.g[1].toFixed(2);
            document.getElementById('gyro-z').textContent = data.g[2].toFixed(2);
            
            // Update data history
            updateHistory(accelData, data.a);
            updateHistory(gyroData, data.g);
            
            // Update charts
            updateChart(accelChart, accelData);
            updateChart(gyroChart, gyroData);
        };
        
        function createChart(ctx, label, colors) {
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(historySize).fill(''),
                    datasets: [
                        { label: 'X', borderColor: colors[0], data: [], fill: false },
                        { label: 'Y', borderColor: colors[1], data: [], fill: false },
                        { label: 'Z', borderColor: colors[2], data: [], fill: false }
                    ]
                },
                options: {
                    responsive: false,
                    title: { display: true, text: label },
                    scales: { yAxes: [{ ticks: { beginAtZero: false } }] }
                }
            });
        }
        
        function updateHistory(store, newData) {
            for (let i = 0; i < 3; i++) {
                store[['x','y','z'][i]].push(newData[i]);
                if (store[['x','y','z'][i]].length > historySize) {
                    store[['x','y','z'][i]].shift();
                }
            }
        }
        
        function updateChart(chart, data) {
            chart.data.datasets[0].data = data.x;
            chart.data.datasets[1].data = data.y;
            chart.data.datasets[2].data = data.z;
            chart.update();
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>